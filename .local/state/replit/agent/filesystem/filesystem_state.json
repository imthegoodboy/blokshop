{"file_contents":{"web/src/app/explore/page.tsx":{"content":"\"use client\";\nexport const dynamic = \"force-dynamic\";\nimport { useState } from \"react\";\nimport { useReadContract, useWriteContract, useWaitForTransactionReceipt } from \"wagmi\";\nimport { marketplaceAbi, MARKETPLACE_ADDRESS } from \"@/lib/contracts\";\nimport { Button, Input } from \"@/components/ui\";\n// removed unused useAccount import\nimport { useEffect } from \"react\";\n\nexport default function ExplorePage() {\n    const [cid, setCid] = useState(\"\");\n    const [query, setQuery] = useState(\"\");\n    const [results, setResults] = useState<any[]>([]);\n    useEffect(() => {\n        const search = typeof window !== \"undefined\" ? new URLSearchParams(window.location.search) : null;\n        const q = search?.get(\"q\");\n        const c = search?.get(\"cid\");\n        if (q) setQuery(q);\n        if (c) setCid(c);\n        (async () => {\n            try {\n                const url = new URL(window.location.origin + \"/api/products\");\n                if (q) url.searchParams.set(\"q\", q);\n                const res = await fetch(url);\n                const json = await res.json();\n                setResults(json.items || []);\n            } catch {}\n        })();\n    }, []);\n    const product = useReadContract(cid\n        ? {\n            abi: marketplaceAbi as any,\n            address: MARKETPLACE_ADDRESS as `0x${string}`,\n            functionName: \"getProduct\",\n            args: [cid]\n        }\n        : (undefined as any)\n    );\n\tconst { writeContract, data: txHash, isPending } = useWriteContract();\n\tconst { isSuccess } = useWaitForTransactionReceipt({ hash: txHash });\n\n\tconst price = (product?.data as any)?.[1] as bigint | undefined;\n\n\tasync function onBuy() {\n\t\tif (!cid || !price) return;\n\t\twriteContract({\n\t\t\tabi: marketplaceAbi as any,\n\t\t\taddress: MARKETPLACE_ADDRESS as `0x${string}`,\n\t\t\tfunctionName: \"purchase\",\n\t\t\targs: [cid],\n\t\t\tvalue: price\n\t\t});\n\t}\n\n\tasync function onDownload() {\n\t\tif (!cid) return;\n\t\tconst message = `download:${cid}`;\n    const signature = await (window as any).ethereum?.request({ method: \"personal_sign\", params: [message, (window as any).ethereum.selectedAddress] });\n\t\tconst res = await fetch(`/api/download/${cid}`, { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ address: (window as any).ethereum.selectedAddress, signature }) });\n\t\tif (res.ok) {\n\t\t\tconst blob = await res.blob();\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\tconst a = document.createElement(\"a\");\n\t\t\ta.href = url;\n\t\t\ta.download = cid;\n\t\t\tdocument.body.appendChild(a);\n\t\t\ta.click();\n\t\t\ta.remove();\n\t\t\tURL.revokeObjectURL(url);\n\t\t}\n\t}\n\n    return (\n        <div className=\"mx-auto max-w-5xl p-6 space-y-6\">\n            <div className=\"flex items-center gap-2\">\n                <Input placeholder=\"Search products\" value={query} onChange={(e) => setQuery(e.target.value)} />\n                <Button onClick={async () => {\n                    const res = await fetch(`/api/products?q=${encodeURIComponent(query)}`);\n                    const json = await res.json();\n                    setResults(json.items || []);\n                }}>Search</Button>\n            </div>\n\n            {cid && (\n                <div className=\"max-w-xl space-y-2\">\n                    <h2 className=\"text-xl font-semibold\">Product</h2>\n                    <Input placeholder=\"Enter IPFS CID\" value={cid} onChange={(e) => setCid(e.target.value)} />\n                    {price !== undefined && <p>Price: {Number(price) / 1e18} MATIC</p>}\n                    <div className=\"flex gap-2\">\n                        <Button onClick={onBuy} disabled={isPending || !price}>Buy</Button>\n                        <Button variant=\"outline\" onClick={onDownload}>Download</Button>\n                    </div>\n                    {txHash && <p>Tx: {txHash}</p>}\n                    {isSuccess && <p>Purchased! You will have access.</p>}\n                </div>\n            )}\n\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4\">\n                {results.map((p) => (\n                    <div key={p._id || p.cid} className=\"border rounded-lg p-4 space-y-1\">\n                        <div className=\"font-medium truncate\">{p.name || p.cid}</div>\n                        {p.description && <div className=\"text-sm text-muted-foreground line-clamp-2\">{p.description}</div>}\n                        <div className=\"text-xs text-muted-foreground\">Category: {p.category}</div>\n                        {p.priceWei && <div className=\"text-sm\">Price: {Number(p.priceWei) / 1e18} MATIC</div>}\n                        <div className=\"flex gap-2 pt-2\">\n                            <Button onClick={() => setCid(p.cid)}>View</Button>\n                            <Button variant=\"outline\" onClick={() => navigator.clipboard.writeText(p.cid)}>Copy CID</Button>\n                        </div>\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n}\n\n\n","size_bytes":4908},"web/src/app/api/chat/route.ts":{"content":"import { NextRequest } from \"next/server\";\n\nexport async function POST(req: NextRequest) {\n\tconst { messages } = await req.json();\n\tconst apiKey = process.env.GEMINI_API_KEY;\n\tif (!apiKey) {\n\t\treturn new Response(JSON.stringify({ error: \"GEMINI_API_KEY missing\" }), { status: 500 });\n\t}\n\t// Minimal pass-through to Gemini (text-only)\n\tconst resp = await fetch(\"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=\" + apiKey, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\tbody: JSON.stringify({\n\t\t\tcontents: [\n\t\t\t\t{ role: \"user\", parts: [{ text: String(messages?.join(\"\\n\")) || \"Help me use the marketplace\" }] }\n\t\t\t]\n\t\t})\n\t});\n\tconst json = await resp.json();\n\tconst text = json.candidates?.[0]?.content?.parts?.[0]?.text || \"\";\n\treturn new Response(JSON.stringify({ text }), { headers: { \"Content-Type\": \"application/json\" } });\n}\n\n\n","size_bytes":902},"web/src/app/api/auth/login/route.ts":{"content":"import { NextRequest } from \"next/server\";\nimport { getDb } from \"@/lib/db\";\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret-change\";\n\nexport async function POST(req: NextRequest) {\n    try {\n        const { email, password } = await req.json();\n        if (!email || !password) return new Response(\"email/password required\", { status: 400 });\n        const db = await getDb();\n        const user = await db.collection(\"users\").findOne({ email: String(email).toLowerCase() });\n        if (!user) return new Response(\"invalid credentials\", { status: 401 });\n        const ok = await bcrypt.compare(password, user.passwordHash);\n        if (!ok) return new Response(\"invalid credentials\", { status: 401 });\n        const token = jwt.sign({ uid: String(user._id), email: user.email }, JWT_SECRET, { expiresIn: \"7d\" });\n        return new Response(JSON.stringify({ ok: true }), {\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Set-Cookie\": `auth=${token}; Path=/; HttpOnly; SameSite=Lax; Max-Age=${7 * 24 * 3600}`\n            }\n        });\n    } catch (e: any) {\n        return new Response(JSON.stringify({ error: e?.message || \"error\" }), { status: 500 });\n    }\n}\n\n\n\n\n","size_bytes":1285},"web/src/app/providers.tsx":{"content":"\"use client\";\nimport { ReactNode, useState } from \"react\";\nimport { WagmiConfig, createConfig, http } from \"wagmi\";\nimport { polygonAmoy } from \"wagmi/chains\";\nimport { injected } from \"@wagmi/connectors\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\n\nconst wagmiConfig = createConfig({\n\tchains: [polygonAmoy],\n\ttransports: {\n\t\t[polygonAmoy.id]: http()\n\t},\n\tconnectors: [injected()]\n});\n\nexport default function Providers({ children }: { children: ReactNode }) {\n\tconst [queryClient] = useState(() => new QueryClient());\n\treturn (\n\t\t<QueryClientProvider client={queryClient}>\n\t\t\t<WagmiConfig config={wagmiConfig}>{children}</WagmiConfig>\n\t\t</QueryClientProvider>\n\t);\n}\n\n\n","size_bytes":700},"web/src/types/global.d.ts":{"content":"declare module 'bcryptjs';\ndeclare module 'jsonwebtoken';\n","size_bytes":58},"web/next.config.ts":{"content":"import type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  outputFileTracingRoot: process.cwd(),\n};\n\nexport default nextConfig;\n","size_bytes":145},"contracts/scripts/deploy.ts":{"content":"import { ethers } from \"hardhat\";\n\nasync function main() {\n\tconst platformFeeBps = Number(process.env.PLATFORM_FEE_BPS || 2000);\n\tconst feeRecipient = process.env.FEE_RECIPIENT as string;\n\tif (!feeRecipient) {\n\t\tthrow new Error(\"FEE_RECIPIENT not set\");\n\t}\n\tconst Marketplace = await ethers.getContractFactory(\"Marketplace\");\n\tconst marketplace = await Marketplace.deploy(platformFeeBps, feeRecipient);\n\tawait marketplace.waitForDeployment();\n\tconsole.log(\"Marketplace deployed to:\", await marketplace.getAddress());\n}\n\nmain().catch((error) => {\n\tconsole.error(error);\n\tprocess.exitCode = 1;\n});\n\n\n","size_bytes":598},"web/src/lib/db.ts":{"content":"import { MongoClient } from \"mongodb\";\n\nconst uri = process.env.MONGODB_URI || \"\";\nconst dbName = process.env.MONGODB_DB || \"blockshopy\";\n\nlet client: MongoClient | null = null;\nexport async function getDb() {\n    if (!uri) throw new Error(\"MONGODB_URI missing\");\n    if (!client) client = new MongoClient(uri);\n    // calling connect is safe even if already connected; avoid checking internal topology fields\n    await client.connect();\n    return client.db(dbName);\n}\n\n\n\n\n","size_bytes":474},"web/src/app/dashboard/buyer/page.tsx":{"content":"\"use client\";\n\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui\";\n\ntype Purchase = {\n  cid: string;\n  name: string;\n  category: string;\n  price: string;\n};\n\nconst dummyPurchases: Purchase[] = [\n  { cid: \"QmDemoCID1\", name: \"Demo Book PDF\", category: \"Books\", price: \"0.05\" },\n  { cid: \"QmDemoCID2\", name: \"Website Clone Code\", category: \"Code\", price: \"0.10\" }\n];\n\nexport default function BuyerDashboard() {\n  const [purchases, setPurchases] = useState<Purchase[]>(dummyPurchases);\n  return (\n    <section className=\"max-w-3xl mx-auto p-8\">\n      <h1 className=\"text-2xl font-bold text-pink-600 mb-6\">Buyer Dashboard</h1>\n      <div className=\"space-y-4\">\n        {purchases.length === 0 ? (\n          <div className=\"text-muted-foreground\">No purchases yet.</div>\n        ) : (\n          purchases.map((p) => (\n            <div key={p.cid} className=\"border rounded-lg p-4 flex justify-between items-center\">\n              <div>\n                <div className=\"font-semibold\">{p.name}</div>\n                <div className=\"text-xs text-muted-foreground\">{p.category} · {p.price} MATIC</div>\n              </div>\n              <Button className=\"bg-pink-600 text-white\">Download</Button>\n            </div>\n          ))\n        )}\n      </div>\n    </section>\n  );\n}\n","size_bytes":1292},"contracts/typechain-types/factories/Marketplace__factory.ts":{"content":"/* Autogenerated file. Do not edit manually. */\n/* tslint:disable */\n/* eslint-disable */\nimport {\n  Contract,\n  ContractFactory,\n  ContractTransactionResponse,\n  Interface,\n} from \"ethers\";\nimport type {\n  Signer,\n  BigNumberish,\n  AddressLike,\n  ContractDeployTransaction,\n  ContractRunner,\n} from \"ethers\";\nimport type { NonPayableOverrides } from \"../common\";\nimport type { Marketplace, MarketplaceInterface } from \"../Marketplace\";\n\nconst _abi = [\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"_platformFeeBps\",\n        type: \"uint256\",\n      },\n      {\n        internalType: \"address payable\",\n        name: \"_feeRecipient\",\n        type: \"address\",\n      },\n    ],\n    stateMutability: \"nonpayable\",\n    type: \"constructor\",\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: \"bytes32\",\n        name: \"id\",\n        type: \"bytes32\",\n      },\n      {\n        indexed: true,\n        internalType: \"address\",\n        name: \"seller\",\n        type: \"address\",\n      },\n      {\n        indexed: false,\n        internalType: \"uint256\",\n        name: \"priceWei\",\n        type: \"uint256\",\n      },\n      {\n        indexed: false,\n        internalType: \"string\",\n        name: \"ipfsCid\",\n        type: \"string\",\n      },\n    ],\n    name: \"ProductListed\",\n    type: \"event\",\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: \"bytes32\",\n        name: \"id\",\n        type: \"bytes32\",\n      },\n      {\n        indexed: true,\n        internalType: \"address\",\n        name: \"buyer\",\n        type: \"address\",\n      },\n      {\n        indexed: false,\n        internalType: \"uint256\",\n        name: \"priceWei\",\n        type: \"uint256\",\n      },\n      {\n        indexed: false,\n        internalType: \"uint256\",\n        name: \"feeAmount\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"ProductPurchased\",\n    type: \"event\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"string\",\n        name: \"ipfsCid\",\n        type: \"string\",\n      },\n    ],\n    name: \"computeId\",\n    outputs: [\n      {\n        internalType: \"bytes32\",\n        name: \"\",\n        type: \"bytes32\",\n      },\n    ],\n    stateMutability: \"pure\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"feeRecipient\",\n    outputs: [\n      {\n        internalType: \"address payable\",\n        name: \"\",\n        type: \"address\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"string\",\n        name: \"ipfsCid\",\n        type: \"string\",\n      },\n    ],\n    name: \"getProduct\",\n    outputs: [\n      {\n        internalType: \"address\",\n        name: \"seller\",\n        type: \"address\",\n      },\n      {\n        internalType: \"uint256\",\n        name: \"priceWei\",\n        type: \"uint256\",\n      },\n      {\n        internalType: \"bool\",\n        name: \"exists\",\n        type: \"bool\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"address\",\n        name: \"buyer\",\n        type: \"address\",\n      },\n      {\n        internalType: \"string\",\n        name: \"ipfsCid\",\n        type: \"string\",\n      },\n    ],\n    name: \"hasBuyerAccess\",\n    outputs: [\n      {\n        internalType: \"bool\",\n        name: \"\",\n        type: \"bool\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"string\",\n        name: \"ipfsCid\",\n        type: \"string\",\n      },\n      {\n        internalType: \"uint256\",\n        name: \"priceWei\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"listProduct\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"platformFeeBps\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"string\",\n        name: \"ipfsCid\",\n        type: \"string\",\n      },\n    ],\n    name: \"purchase\",\n    outputs: [],\n    stateMutability: \"payable\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"_platformFeeBps\",\n        type: \"uint256\",\n      },\n      {\n        internalType: \"address payable\",\n        name: \"_feeRecipient\",\n        type: \"address\",\n      },\n    ],\n    name: \"setPlatformParams\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n] as const;\n\nconst _bytecode =\n  \"0x608060405234801561001057600080fd5b50604051610e26380380610e2683398101604081905261002f916100e5565b6113888211156100755760405162461bcd60e51b815260206004820152600c60248201526b0cccaca40e8dede40d0d2ced60a31b60448201526064015b60405180910390fd5b6001600160a01b0381166100bb5760405162461bcd60e51b815260206004820152600d60248201526c189859081c9958da5c1a595b9d609a1b604482015260640161006c565b600191909155600280546001600160a01b0319166001600160a01b03909216919091179055610122565b600080604083850312156100f857600080fd5b825160208401519092506001600160a01b038116811461011757600080fd5b809150509250929050565b610cf5806101316000396000f3fe60806040526004361061007b5760003560e01c806368111cce1161004e57806368111cce14610116578063698cd96b1461015d57806389a1b5231461018d578063fb021939146101ad57600080fd5b806322dcd13e146100805780633ae80656146100a957806346904840146100cb57806359f5e0ce14610103575b600080fd5b34801561008c57600080fd5b5061009660015481565b6040519081526020015b60405180910390f35b3480156100b557600080fd5b506100c96100c4366004610883565b6101cd565b005b3480156100d757600080fd5b506002546100eb906001600160a01b031681565b6040516001600160a01b0390911681526020016100a0565b6100c96101113660046108fc565b6102da565b34801561012257600080fd5b506101366101313660046108fc565b6105c4565b604080516001600160a01b03909416845260208401929092521515908201526060016100a0565b34801561016957600080fd5b5061017d61017836600461093e565b61063f565b60405190151581526020016100a0565b34801561019957600080fd5b506100c96101a8366004610993565b6106eb565b3480156101b957600080fd5b506100966101c83660046109f5565b61083b565b6002546001600160a01b0316331461022c5760405162461bcd60e51b815260206004820152601960248201527f6f6e6c7920726563697069656e742063616e207570646174650000000000000060448201526064015b60405180910390fd5b61138882111561026d5760405162461bcd60e51b815260206004820152600c60248201526b0cccaca40e8dede40d0d2ced60a31b6044820152606401610223565b6001600160a01b0381166102b35760405162461bcd60e51b815260206004820152600d60248201526c189859081c9958da5c1a595b9d609a1b6044820152606401610223565b600191909155600280546001600160a01b0319166001600160a01b03909216919091179055565b600061031b83838080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525061083b92505050565b600081815260208190526040902060038101549192509060ff1661036e5760405162461bcd60e51b815260206004820152600a6024820152691b9bdd081b1a5cdd195960b21b6044820152606401610223565b806001015434146103ae5760405162461bcd60e51b815260206004820152600a60248201526918985908185b5bdd5b9d60b21b6044820152606401610223565b33600090815260048201602052604090205460ff16156104015760405162461bcd60e51b815260206004820152600e60248201526d185b1c9958591e48189bdd59da1d60921b6044820152606401610223565b6000612710600154346104149190610abc565b61041e9190610ad9565b9050600061042c8234610afb565b3360009081526004850160205260409020805460ff19166001179055905081156104e7576002546040516000916001600160a01b03169084908381818185875af1925050503d806000811461049d576040519150601f19603f3d011682016040523d82523d6000602084013e6104a2565b606091505b50509050806104e55760405162461bcd60e51b815260206004820152600f60248201526e199959481e19995c8819985a5b1959608a1b6044820152606401610223565b505b82546040516000916001600160a01b03169083908381818185875af1925050503d8060008114610533576040519150601f19603f3d011682016040523d82523d6000602084013e610538565b606091505b505090508061057e5760405162461bcd60e51b81526020600482015260126024820152711cd95b1b195c881e19995c8819985a5b195960721b6044820152606401610223565b6040805134815260208101859052339187917fb37669e5ea8838b0d301cbb9302778cf8beb9d4a2525ad74dd16210000329535910160405180910390a350505050505050565b60008060008061060986868080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525061083b92505050565b6000908152602081905260409020805460018201546003909201546001600160a01b039091169891975060ff1695509350505050565b60008061068184848080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525061083b92505050565b600081815260208190526040902060038101549192509060ff166106aa576000925050506106e4565b6001600160a01b038616600090815260048201602052604090205460ff16806106df575080546001600160a01b038781169116145b925050505b9392505050565b600081116107255760405162461bcd60e51b8152602060048201526007602482015266070726963653d360cc1b6044820152606401610223565b600061076684848080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525061083b92505050565b600081815260208190526040902060038101549192509060ff16156107be5760405162461bcd60e51b815260206004820152600e60248201526d185b1c9958591e481b1a5cdd195960921b6044820152606401610223565b80546001600160a01b0319163317815560018101839055600281016107e4858783610b99565b5060038101805460ff19166001179055604051339083907f15bab8852b3644841f540490021c0a29457499427e4150468853e071fe008c7a9061082c9087908a908a90610c5a565b60405180910390a35050505050565b60008160405160200161084e9190610c90565b604051602081830303815290604052805190602001209050919050565b6001600160a01b038116811461088057600080fd5b50565b6000806040838503121561089657600080fd5b8235915060208301356108a88161086b565b809150509250929050565b60008083601f8401126108c557600080fd5b50813567ffffffffffffffff8111156108dd57600080fd5b6020830191508360208285010111156108f557600080fd5b9250929050565b6000806020838503121561090f57600080fd5b823567ffffffffffffffff81111561092657600080fd5b610932858286016108b3565b90969095509350505050565b60008060006040848603121561095357600080fd5b833561095e8161086b565b9250602084013567ffffffffffffffff81111561097a57600080fd5b610986868287016108b3565b9497909650939450505050565b6000806000604084860312156109a857600080fd5b833567ffffffffffffffff8111156109bf57600080fd5b6109cb868287016108b3565b909790965060209590950135949350505050565b634e487b7160e01b600052604160045260246000fd5b600060208284031215610a0757600080fd5b813567ffffffffffffffff80821115610a1f57600080fd5b818401915084601f830112610a3357600080fd5b813581811115610a4557610a456109df565b604051601f8201601f19908116603f01168101908382118183101715610a6d57610a6d6109df565b81604052828152876020848701011115610a8657600080fd5b826020860160208301376000928101602001929092525095945050505050565b634e487b7160e01b600052601160045260246000fd5b8082028115828204841417610ad357610ad3610aa6565b92915050565b600082610af657634e487b7160e01b600052601260045260246000fd5b500490565b81810381811115610ad357610ad3610aa6565b600181811c90821680610b2257607f821691505b602082108103610b4257634e487b7160e01b600052602260045260246000fd5b50919050565b601f821115610b94576000816000526020600020601f850160051c81016020861015610b715750805b601f850160051c820191505b81811015610b9057828155600101610b7d565b5050505b505050565b67ffffffffffffffff831115610bb157610bb16109df565b610bc583610bbf8354610b0e565b83610b48565b6000601f841160018114610bf95760008515610be15750838201355b600019600387901b1c1916600186901b178355610c53565b600083815260209020601f19861690835b82811015610c2a5786850135825560209485019460019092019101610c0a565b5086821015610c475760001960f88860031b161c19848701351681555b505060018560011b0183555b5050505050565b83815260406020820152816040820152818360608301376000818301606090810191909152601f909201601f1916010192915050565b6000825160005b81811015610cb15760208186018101518583015201610c97565b50600092019182525091905056fea2646970667358221220708828e4c0d406bb67b7c005ac78706e423802490ce4b95a3ea0a208be40f0fc64736f6c63430008180033\";\n\ntype MarketplaceConstructorParams =\n  | [signer?: Signer]\n  | ConstructorParameters<typeof ContractFactory>;\n\nconst isSuperArgs = (\n  xs: MarketplaceConstructorParams\n): xs is ConstructorParameters<typeof ContractFactory> => xs.length > 1;\n\nexport class Marketplace__factory extends ContractFactory {\n  constructor(...args: MarketplaceConstructorParams) {\n    if (isSuperArgs(args)) {\n      super(...args);\n    } else {\n      super(_abi, _bytecode, args[0]);\n    }\n  }\n\n  override getDeployTransaction(\n    _platformFeeBps: BigNumberish,\n    _feeRecipient: AddressLike,\n    overrides?: NonPayableOverrides & { from?: string }\n  ): Promise<ContractDeployTransaction> {\n    return super.getDeployTransaction(\n      _platformFeeBps,\n      _feeRecipient,\n      overrides || {}\n    );\n  }\n  override deploy(\n    _platformFeeBps: BigNumberish,\n    _feeRecipient: AddressLike,\n    overrides?: NonPayableOverrides & { from?: string }\n  ) {\n    return super.deploy(\n      _platformFeeBps,\n      _feeRecipient,\n      overrides || {}\n    ) as Promise<\n      Marketplace & {\n        deploymentTransaction(): ContractTransactionResponse;\n      }\n    >;\n  }\n  override connect(runner: ContractRunner | null): Marketplace__factory {\n    return super.connect(runner) as Marketplace__factory;\n  }\n\n  static readonly bytecode = _bytecode;\n  static readonly abi = _abi;\n  static createInterface(): MarketplaceInterface {\n    return new Interface(_abi) as MarketplaceInterface;\n  }\n  static connect(address: string, runner?: ContractRunner | null): Marketplace {\n    return new Contract(address, _abi, runner) as unknown as Marketplace;\n  }\n}\n","size_bytes":13447},"web/src/lib/contracts.ts":{"content":"export const MARKETPLACE_ADDRESS = process.env.NEXT_PUBLIC_MARKETPLACE_ADDRESS || \"\";\n\nexport const marketplaceAbi = [\n\t{\n\t\t\"inputs\": [\n\t\t\t{ \"internalType\": \"uint256\", \"name\": \"_platformFeeBps\", \"type\": \"uint256\" },\n\t\t\t{ \"internalType\": \"address payable\", \"name\": \"_feeRecipient\", \"type\": \"address\" }\n\t\t],\n\t\t\"stateMutability\": \"nonpayable\",\n\t\t\"type\": \"constructor\"\n\t},\n\t{ \"inputs\": [], \"name\": \"platformFeeBps\", \"outputs\": [{ \"internalType\": \"uint256\", \"name\": \"\", \"type\": \"uint256\" }], \"stateMutability\": \"view\", \"type\": \"function\" },\n\t{ \"inputs\": [], \"name\": \"feeRecipient\", \"outputs\": [{ \"internalType\": \"address payable\", \"name\": \"\", \"type\": \"address\" }], \"stateMutability\": \"view\", \"type\": \"function\" },\n\t{ \"inputs\": [{ \"internalType\": \"string\", \"name\": \"ipfsCid\", \"type\": \"string\" }], \"name\": \"computeId\", \"outputs\": [{ \"internalType\": \"bytes32\", \"name\": \"\", \"type\": \"bytes32\" }], \"stateMutability\": \"pure\", \"type\": \"function\" },\n\t{ \"inputs\": [{ \"internalType\": \"string\", \"name\": \"ipfsCid\", \"type\": \"string\" }], \"name\": \"getProduct\", \"outputs\": [\n\t\t{ \"internalType\": \"address\", \"name\": \"seller\", \"type\": \"address\" },\n\t\t{ \"internalType\": \"uint256\", \"name\": \"priceWei\", \"type\": \"uint256\" },\n\t\t{ \"internalType\": \"bool\", \"name\": \"exists\", \"type\": \"bool\" }\n\t], \"stateMutability\": \"view\", \"type\": \"function\" },\n\t{ \"inputs\": [{ \"internalType\": \"string\", \"name\": \"ipfsCid\", \"type\": \"string\" }, { \"internalType\": \"uint256\", \"name\": \"priceWei\", \"type\": \"uint256\" }], \"name\": \"listProduct\", \"outputs\": [], \"stateMutability\": \"nonpayable\", \"type\": \"function\" },\n\t{ \"inputs\": [{ \"internalType\": \"string\", \"name\": \"ipfsCid\", \"type\": \"string\" }], \"name\": \"hasBuyerAccess\", \"outputs\": [{ \"internalType\": \"bool\", \"name\": \"\", \"type\": \"bool\" }], \"stateMutability\": \"view\", \"type\": \"function\" },\n\t{ \"inputs\": [{ \"internalType\": \"string\", \"name\": \"ipfsCid\", \"type\": \"string\" }], \"name\": \"purchase\", \"outputs\": [], \"stateMutability\": \"payable\", \"type\": \"function\" }\n];\n\n\n","size_bytes":1955},"contracts/typechain-types/common.ts":{"content":"/* Autogenerated file. Do not edit manually. */\n/* tslint:disable */\n/* eslint-disable */\nimport type {\n  FunctionFragment,\n  Typed,\n  EventFragment,\n  ContractTransaction,\n  ContractTransactionResponse,\n  DeferredTopicFilter,\n  EventLog,\n  TransactionRequest,\n  LogDescription,\n} from \"ethers\";\n\nexport interface TypedDeferredTopicFilter<_TCEvent extends TypedContractEvent>\n  extends DeferredTopicFilter {}\n\nexport interface TypedContractEvent<\n  InputTuple extends Array<any> = any,\n  OutputTuple extends Array<any> = any,\n  OutputObject = any\n> {\n  (...args: Partial<InputTuple>): TypedDeferredTopicFilter<\n    TypedContractEvent<InputTuple, OutputTuple, OutputObject>\n  >;\n  name: string;\n  fragment: EventFragment;\n  getFragment(...args: Partial<InputTuple>): EventFragment;\n}\n\ntype __TypechainAOutputTuple<T> = T extends TypedContractEvent<\n  infer _U,\n  infer W\n>\n  ? W\n  : never;\ntype __TypechainOutputObject<T> = T extends TypedContractEvent<\n  infer _U,\n  infer _W,\n  infer V\n>\n  ? V\n  : never;\n\nexport interface TypedEventLog<TCEvent extends TypedContractEvent>\n  extends Omit<EventLog, \"args\"> {\n  args: __TypechainAOutputTuple<TCEvent> & __TypechainOutputObject<TCEvent>;\n}\n\nexport interface TypedLogDescription<TCEvent extends TypedContractEvent>\n  extends Omit<LogDescription, \"args\"> {\n  args: __TypechainAOutputTuple<TCEvent> & __TypechainOutputObject<TCEvent>;\n}\n\nexport type TypedListener<TCEvent extends TypedContractEvent> = (\n  ...listenerArg: [\n    ...__TypechainAOutputTuple<TCEvent>,\n    TypedEventLog<TCEvent>,\n    ...undefined[]\n  ]\n) => void;\n\nexport type MinEthersFactory<C, ARGS> = {\n  deploy(...a: ARGS[]): Promise<C>;\n};\n\nexport type GetContractTypeFromFactory<F> = F extends MinEthersFactory<\n  infer C,\n  any\n>\n  ? C\n  : never;\nexport type GetARGsTypeFromFactory<F> = F extends MinEthersFactory<any, any>\n  ? Parameters<F[\"deploy\"]>\n  : never;\n\nexport type StateMutability = \"nonpayable\" | \"payable\" | \"view\";\n\nexport type BaseOverrides = Omit<TransactionRequest, \"to\" | \"data\">;\nexport type NonPayableOverrides = Omit<\n  BaseOverrides,\n  \"value\" | \"blockTag\" | \"enableCcipRead\"\n>;\nexport type PayableOverrides = Omit<\n  BaseOverrides,\n  \"blockTag\" | \"enableCcipRead\"\n>;\nexport type ViewOverrides = Omit<TransactionRequest, \"to\" | \"data\">;\nexport type Overrides<S extends StateMutability> = S extends \"nonpayable\"\n  ? NonPayableOverrides\n  : S extends \"payable\"\n  ? PayableOverrides\n  : ViewOverrides;\n\nexport type PostfixOverrides<A extends Array<any>, S extends StateMutability> =\n  | A\n  | [...A, Overrides<S>];\nexport type ContractMethodArgs<\n  A extends Array<any>,\n  S extends StateMutability\n> = PostfixOverrides<{ [I in keyof A]-?: A[I] | Typed }, S>;\n\nexport type DefaultReturnType<R> = R extends Array<any> ? R[0] : R;\n\n// export interface ContractMethod<A extends Array<any> = Array<any>, R = any, D extends R | ContractTransactionResponse = R | ContractTransactionResponse> {\nexport interface TypedContractMethod<\n  A extends Array<any> = Array<any>,\n  R = any,\n  S extends StateMutability = \"payable\"\n> {\n  (...args: ContractMethodArgs<A, S>): S extends \"view\"\n    ? Promise<DefaultReturnType<R>>\n    : Promise<ContractTransactionResponse>;\n\n  name: string;\n\n  fragment: FunctionFragment;\n\n  getFragment(...args: ContractMethodArgs<A, S>): FunctionFragment;\n\n  populateTransaction(\n    ...args: ContractMethodArgs<A, S>\n  ): Promise<ContractTransaction>;\n  staticCall(\n    ...args: ContractMethodArgs<A, \"view\">\n  ): Promise<DefaultReturnType<R>>;\n  send(...args: ContractMethodArgs<A, S>): Promise<ContractTransactionResponse>;\n  estimateGas(...args: ContractMethodArgs<A, S>): Promise<bigint>;\n  staticCallResult(...args: ContractMethodArgs<A, \"view\">): Promise<R>;\n}\n","size_bytes":3718},"README.md":{"content":"# BlockShopy (Polygon Amoy testnet)\n\nA decentralized marketplace for digital goods (images, PDFs, files). Sellers upload to IPFS and list on-chain; buyers pay in MATIC. Platform automatically takes a 20% fee and sends 80% to the seller.\n\n## Stack\n- Next.js (App Router, Tailwind)\n- wagmi + RainbowKit (wallet connect)\n- Hardhat + Solidity (Polygon Amoy)\n- IPFS via Web3.Storage\n- Gemini chatbot helper\n\n## 1) Prerequisites\n- Node 18+\n- A Polygon Amoy testnet wallet with test MATIC\n- API keys:\n  - Web3.Storage token (free)\n  - WalletConnect Cloud Project ID (free)\n  - Gemini API key (free)\n  - Optional: Polygonscan API key (for contract verification)\n\n## 2) Contracts setup\n```bash\ncd contracts\n# create .env with the following keys\n# AMOY_RPC_URL=https://rpc-amoy.polygon.technology\n# PRIVATE_KEY=0xYOUR_PRIVATE_KEY\n# POLYGONSCAN_API_KEY=your_polygonscan_key\n# FEE_RECIPIENT=0xYourFeeRecipientAddress  # receives the 20% fee\n# PLATFORM_FEE_BPS=2000                    # 20%\n\nnpm run build\nnpm run deploy:amoy\n```\nDeployment output prints the `Marketplace` address. Copy it.\n\n## 3) Web setup\n```bash\ncd ../web\n# create .env with the following keys\n# NEXT_PUBLIC_WALLETCONNECT_ID=your_walletconnect_cloud_project_id\n# NEXT_PUBLIC_MARKETPLACE_ADDRESS=0xDeployedMarketplaceAddress\n# WEB3_STORAGE_TOKEN=your_web3_storage_api_token\n# GEMINI_API_KEY=your_google_generative_ai_api_key\n\nnpm run dev\n```\nOpen http://localhost:3000.\n\n## 4) App usage\n- Sell: upload a file to IPFS, set price, then list on-chain.\n- Explore: paste a product CID, view price, and purchase in MATIC.\n- Dashboard: enter your CID to view listing details.\n- Chatbot: bottom-right helper for guidance.\n\n## Notes\n- Fees: 20% to `FEE_RECIPIENT`, 80% to seller. Adjustable via contract function `setPlatformParams` (only current `feeRecipient` can change).\n- Storage: Files stored on IPFS via Web3.Storage. CID is referenced in the contract.\n- Access: Contract records purchase; your backend/UI should gate downloads by checking `hasBuyerAccess(buyer, cid)`.\n- Network: Polygon Amoy only (testnet).\n\n## Verify contract (optional)\n```bash\nnpx hardhat verify --network amoy <DEPLOYED_ADDRESS> 2000 0xYourFeeRecipientAddress\n```\n\n## Troubleshooting\n- If wallet connect fails, check `NEXT_PUBLIC_WALLETCONNECT_ID`.\n- If uploads fail, verify `WEB3_STORAGE_TOKEN` and that the selected file is small enough for the free tier.\n- Ensure `NEXT_PUBLIC_MARKETPLACE_ADDRESS` matches the deployed address.\n","size_bytes":2458},"contracts/contracts/Marketplace.sol":{"content":"// SPDX-License-Identifier: MIT\npragma solidity ^0.8.24;\n\ncontract Marketplace {\n\tstruct Product {\n\t\taddress payable seller;\n\t\tuint256 priceWei;\n\t\tstring ipfsCid;\n\t\tbool exists;\n\t\tmapping(address => bool) hasAccess;\n\t}\n\n\tmapping(bytes32 => Product) private products;\n\tuint256 public platformFeeBps; // e.g., 2000 = 20%\n\taddress payable public feeRecipient;\n\n\tevent ProductListed(bytes32 indexed id, address indexed seller, uint256 priceWei, string ipfsCid);\n\tevent ProductPurchased(bytes32 indexed id, address indexed buyer, uint256 priceWei, uint256 feeAmount);\n\n\tconstructor(uint256 _platformFeeBps, address payable _feeRecipient) {\n\t\trequire(_platformFeeBps <= 5000, \"fee too high\");\n\t\trequire(_feeRecipient != address(0), \"bad recipient\");\n\t\tplatformFeeBps = _platformFeeBps;\n\t\tfeeRecipient = _feeRecipient;\n\t}\n\n\tfunction setPlatformParams(uint256 _platformFeeBps, address payable _feeRecipient) external {\n\t\trequire(msg.sender == feeRecipient, \"only recipient can update\");\n\t\trequire(_platformFeeBps <= 5000, \"fee too high\");\n\t\trequire(_feeRecipient != address(0), \"bad recipient\");\n\t\tplatformFeeBps = _platformFeeBps;\n\t\tfeeRecipient = _feeRecipient;\n\t}\n\n\tfunction computeId(string memory ipfsCid) public pure returns (bytes32) {\n\t\treturn keccak256(abi.encodePacked(ipfsCid));\n\t}\n\n\tfunction listProduct(string calldata ipfsCid, uint256 priceWei) external {\n\t\trequire(priceWei > 0, \"price=0\");\n\t\tbytes32 id = computeId(ipfsCid);\n\t\tProduct storage p = products[id];\n\t\trequire(!p.exists, \"already listed\");\n\t\tp.seller = payable(msg.sender);\n\t\tp.priceWei = priceWei;\n\t\tp.ipfsCid = ipfsCid;\n\t\tp.exists = true;\n\t\temit ProductListed(id, msg.sender, priceWei, ipfsCid);\n\t}\n\n\tfunction getProduct(string calldata ipfsCid) external view returns (address seller, uint256 priceWei, bool exists) {\n\t\tbytes32 id = computeId(ipfsCid);\n\t\tProduct storage p = products[id];\n\t\treturn (p.seller, p.priceWei, p.exists);\n\t}\n\n\tfunction hasBuyerAccess(address buyer, string calldata ipfsCid) external view returns (bool) {\n\t\tbytes32 id = computeId(ipfsCid);\n\t\tProduct storage p = products[id];\n\t\tif (!p.exists) return false;\n\t\treturn p.hasAccess[buyer] || buyer == p.seller;\n\t}\n\n\tfunction purchase(string calldata ipfsCid) external payable {\n\t\tbytes32 id = computeId(ipfsCid);\n\t\tProduct storage p = products[id];\n\t\trequire(p.exists, \"not listed\");\n\t\trequire(msg.value == p.priceWei, \"bad amount\");\n\t\trequire(!p.hasAccess[msg.sender], \"already bought\");\n\n\t\tuint256 feeAmount = (msg.value * platformFeeBps) / 10000;\n\t\tuint256 sellerAmount = msg.value - feeAmount;\n\n\t\tp.hasAccess[msg.sender] = true;\n\n\t\tif (feeAmount > 0) {\n\t\t\t(bool fOk, ) = feeRecipient.call{value: feeAmount}(\"\");\n\t\t\trequire(fOk, \"fee xfer failed\");\n\t\t}\n\t\t(bool sOk, ) = p.seller.call{value: sellerAmount}(\"\");\n\t\trequire(sOk, \"seller xfer failed\");\n\n\t\temit ProductPurchased(id, msg.sender, msg.value, feeAmount);\n\t}\n}\n\n\n","size_bytes":2866},"web/src/app/api/auth/signup/route.ts":{"content":"import { NextRequest } from \"next/server\";\nimport { getDb } from \"@/lib/db\";\nimport bcrypt from \"bcryptjs\";\n\nexport async function POST(req: NextRequest) {\n    try {\n        const { email, password } = await req.json();\n        if (!email || !password) return new Response(\"email/password required\", { status: 400 });\n        const db = await getDb();\n        const existing = await db.collection(\"users\").findOne({ email: String(email).toLowerCase() });\n        if (existing) return new Response(\"user exists\", { status: 409 });\n        const passwordHash = await bcrypt.hash(password, 10);\n        await db.collection(\"users\").insertOne({ email: String(email).toLowerCase(), passwordHash, createdAt: new Date() });\n        return new Response(JSON.stringify({ ok: true }), { headers: { \"Content-Type\": \"application/json\" } });\n    } catch (e: any) {\n        return new Response(JSON.stringify({ error: e?.message || \"error\" }), { status: 500 });\n    }\n}\n\n\n\n\n","size_bytes":960},"contracts/typechain-types/hardhat.d.ts":{"content":"/* Autogenerated file. Do not edit manually. */\n/* tslint:disable */\n/* eslint-disable */\n\nimport { ethers } from \"ethers\";\nimport {\n  DeployContractOptions,\n  FactoryOptions,\n  HardhatEthersHelpers as HardhatEthersHelpersBase,\n} from \"@nomicfoundation/hardhat-ethers/types\";\n\nimport * as Contracts from \".\";\n\ndeclare module \"hardhat/types/runtime\" {\n  interface HardhatEthersHelpers extends HardhatEthersHelpersBase {\n    getContractFactory(\n      name: \"Marketplace\",\n      signerOrOptions?: ethers.Signer | FactoryOptions\n    ): Promise<Contracts.Marketplace__factory>;\n\n    getContractAt(\n      name: \"Marketplace\",\n      address: string | ethers.Addressable,\n      signer?: ethers.Signer\n    ): Promise<Contracts.Marketplace>;\n\n    deployContract(\n      name: \"Marketplace\",\n      signerOrOptions?: ethers.Signer | DeployContractOptions\n    ): Promise<Contracts.Marketplace>;\n\n    deployContract(\n      name: \"Marketplace\",\n      args: any[],\n      signerOrOptions?: ethers.Signer | DeployContractOptions\n    ): Promise<Contracts.Marketplace>;\n\n    // default types\n    getContractFactory(\n      name: string,\n      signerOrOptions?: ethers.Signer | FactoryOptions\n    ): Promise<ethers.ContractFactory>;\n    getContractFactory(\n      abi: any[],\n      bytecode: ethers.BytesLike,\n      signer?: ethers.Signer\n    ): Promise<ethers.ContractFactory>;\n    getContractAt(\n      nameOrAbi: string | any[],\n      address: string | ethers.Addressable,\n      signer?: ethers.Signer\n    ): Promise<ethers.Contract>;\n    deployContract(\n      name: string,\n      signerOrOptions?: ethers.Signer | DeployContractOptions\n    ): Promise<ethers.Contract>;\n    deployContract(\n      name: string,\n      args: any[],\n      signerOrOptions?: ethers.Signer | DeployContractOptions\n    ): Promise<ethers.Contract>;\n  }\n}\n","size_bytes":1808},"web/src/components/ProductCard.tsx":{"content":"\"use client\";\nimport Link from \"next/link\";\nimport React from \"react\";\n\nexport default function ProductCard({ product }: { product: any }) {\n  return (\n    <div className=\"bg-card rounded-2xl shadow-md overflow-hidden flex flex-col\">\n      <Link href={`/product/${product.cid}`} className=\"block h-40 bg-gray-200\">\n        <img src={product.image || '/placeholder.png'} alt={product.name || product.cid} className=\"w-full h-40 object-cover\" />\n      </Link>\n      <div className=\"p-4 flex-1 flex flex-col\">\n        <div className=\"text-sm font-semibold truncate\">{product.name || product.cid}</div>\n        <div className=\"text-xs text-muted-foreground line-clamp-2 mt-1\">{product.description || \"No description\"}</div>\n        <div className=\"mt-3 flex items-center justify-between\">\n          <div className=\"text-sm font-medium\">{product.priceWei ? (Number(product.priceWei)/1e18).toFixed(3) : '—'} MATIC</div>\n          <div className=\"text-xs text-muted-foreground\">{String(product.seller || '').slice(0,6)}...{String(product.seller || '').slice(-4)}</div>\n        </div>\n        <div className=\"mt-3 flex gap-2\">\n          <Link href={`/product/${product.cid}`} className=\"flex-1 text-center rounded-xl btn-accent py-2\">View</Link>\n          <button className=\"flex-1 rounded-xl border py-2\">Buy</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1359},"contracts/typechain-types/index.ts":{"content":"/* Autogenerated file. Do not edit manually. */\n/* tslint:disable */\n/* eslint-disable */\nexport type { Marketplace } from \"./Marketplace\";\nexport * as factories from \"./factories\";\nexport { Marketplace__factory } from \"./factories/Marketplace__factory\";\n","size_bytes":255},"web/src/app/product/[cid]/page.tsx":{"content":"\"use client\";\nimport { Button } from \"@/components/ui\";\n\nexport default function ProductDetail() {\n  // Dummy product for demo\n  const product = {\n    name: \"Demo Book PDF\",\n    category: \"Books\",\n    price: \"0.05\",\n    description: \"A sample book PDF for demo purposes.\",\n    seller: \"0xSellerAddress\",\n    cid: \"QmDemoCID123\",\n    image: \"/product-placeholder.png\"\n  };\n  return (\n    <section className=\"max-w-2xl mx-auto p-8\">\n      <div className=\"flex gap-6\">\n        <img src={product.image} alt={product.name} className=\"w-48 h-48 object-cover rounded-lg border-2 border-pink-400\" />\n        <div className=\"flex-1\">\n          <h1 className=\"text-2xl font-bold text-pink-600 mb-2\">{product.name}</h1>\n          <div className=\"text-sm text-muted-foreground mb-2\">Category: {product.category}</div>\n          <div className=\"mb-4\">{product.description}</div>\n          <div className=\"text-lg font-semibold mb-2\">Price: {product.price} MATIC</div>\n          <div className=\"text-xs mb-4\">Seller: {product.seller}</div>\n          <Button className=\"bg-pink-600 text-white\">Buy Now</Button>\n        </div>\n      </div>\n    </section>\n  );\n}\n","size_bytes":1146},"web/src/app/dashboard/page.tsx":{"content":"\"use client\";\nimport { useState } from \"react\";\nimport { useAccount, useReadContract } from \"wagmi\";\nimport { marketplaceAbi, MARKETPLACE_ADDRESS } from \"@/lib/contracts\";\nimport { Input } from \"@/components/ui\";\n\n// Minimal dashboard showing seller products by entering their own CIDs\nexport default function DashboardPage() {\n\tconst { address } = useAccount();\n\tconst [cid, setCid] = useState(\"\");\n    const product = useReadContract(cid\n        ? {\n            abi: marketplaceAbi as any,\n            address: MARKETPLACE_ADDRESS as `0x${string}`,\n            functionName: \"getProduct\",\n            args: [cid]\n        }\n        : (undefined as any)\n    );\n\n\treturn (\n\t\t<div className=\"max-w-xl mx-auto p-6 space-y-4\">\n\t\t\t<h2 className=\"text-xl font-semibold\">Seller dashboard</h2>\n\t\t\t<p className=\"text-sm text-muted-foreground\">Connected: {address || \"not connected\"}</p>\n            <Input placeholder=\"Enter your product CID\" value={cid} onChange={(e) => setCid(e.target.value)} />\n            {product?.data ? (\n\t\t\t\t<div className=\"border rounded p-3\">\n\t\t\t\t\t<p>CID: {cid}</p>\n                    <p>Price (MATIC): {Number((product.data as any)[1]) / 1e18}</p>\n\t\t\t\t\t<p>Seller: {(product.data as any)[0]}</p>\n\t\t\t\t</div>\n            ) : null}\n\t\t</div>\n\t);\n}\n\n\n","size_bytes":1266},"contracts/typechain-types/factories/index.ts":{"content":"/* Autogenerated file. Do not edit manually. */\n/* tslint:disable */\n/* eslint-disable */\nexport { Marketplace__factory } from \"./Marketplace__factory\";\n","size_bytes":153},"contracts/typechain-types/Marketplace.ts":{"content":"/* Autogenerated file. Do not edit manually. */\n/* tslint:disable */\n/* eslint-disable */\nimport type {\n  BaseContract,\n  BigNumberish,\n  BytesLike,\n  FunctionFragment,\n  Result,\n  Interface,\n  EventFragment,\n  AddressLike,\n  ContractRunner,\n  ContractMethod,\n  Listener,\n} from \"ethers\";\nimport type {\n  TypedContractEvent,\n  TypedDeferredTopicFilter,\n  TypedEventLog,\n  TypedLogDescription,\n  TypedListener,\n  TypedContractMethod,\n} from \"./common\";\n\nexport interface MarketplaceInterface extends Interface {\n  getFunction(\n    nameOrSignature:\n      | \"computeId\"\n      | \"feeRecipient\"\n      | \"getProduct\"\n      | \"hasBuyerAccess\"\n      | \"listProduct\"\n      | \"platformFeeBps\"\n      | \"purchase\"\n      | \"setPlatformParams\"\n  ): FunctionFragment;\n\n  getEvent(\n    nameOrSignatureOrTopic: \"ProductListed\" | \"ProductPurchased\"\n  ): EventFragment;\n\n  encodeFunctionData(functionFragment: \"computeId\", values: [string]): string;\n  encodeFunctionData(\n    functionFragment: \"feeRecipient\",\n    values?: undefined\n  ): string;\n  encodeFunctionData(functionFragment: \"getProduct\", values: [string]): string;\n  encodeFunctionData(\n    functionFragment: \"hasBuyerAccess\",\n    values: [AddressLike, string]\n  ): string;\n  encodeFunctionData(\n    functionFragment: \"listProduct\",\n    values: [string, BigNumberish]\n  ): string;\n  encodeFunctionData(\n    functionFragment: \"platformFeeBps\",\n    values?: undefined\n  ): string;\n  encodeFunctionData(functionFragment: \"purchase\", values: [string]): string;\n  encodeFunctionData(\n    functionFragment: \"setPlatformParams\",\n    values: [BigNumberish, AddressLike]\n  ): string;\n\n  decodeFunctionResult(functionFragment: \"computeId\", data: BytesLike): Result;\n  decodeFunctionResult(\n    functionFragment: \"feeRecipient\",\n    data: BytesLike\n  ): Result;\n  decodeFunctionResult(functionFragment: \"getProduct\", data: BytesLike): Result;\n  decodeFunctionResult(\n    functionFragment: \"hasBuyerAccess\",\n    data: BytesLike\n  ): Result;\n  decodeFunctionResult(\n    functionFragment: \"listProduct\",\n    data: BytesLike\n  ): Result;\n  decodeFunctionResult(\n    functionFragment: \"platformFeeBps\",\n    data: BytesLike\n  ): Result;\n  decodeFunctionResult(functionFragment: \"purchase\", data: BytesLike): Result;\n  decodeFunctionResult(\n    functionFragment: \"setPlatformParams\",\n    data: BytesLike\n  ): Result;\n}\n\nexport namespace ProductListedEvent {\n  export type InputTuple = [\n    id: BytesLike,\n    seller: AddressLike,\n    priceWei: BigNumberish,\n    ipfsCid: string\n  ];\n  export type OutputTuple = [\n    id: string,\n    seller: string,\n    priceWei: bigint,\n    ipfsCid: string\n  ];\n  export interface OutputObject {\n    id: string;\n    seller: string;\n    priceWei: bigint;\n    ipfsCid: string;\n  }\n  export type Event = TypedContractEvent<InputTuple, OutputTuple, OutputObject>;\n  export type Filter = TypedDeferredTopicFilter<Event>;\n  export type Log = TypedEventLog<Event>;\n  export type LogDescription = TypedLogDescription<Event>;\n}\n\nexport namespace ProductPurchasedEvent {\n  export type InputTuple = [\n    id: BytesLike,\n    buyer: AddressLike,\n    priceWei: BigNumberish,\n    feeAmount: BigNumberish\n  ];\n  export type OutputTuple = [\n    id: string,\n    buyer: string,\n    priceWei: bigint,\n    feeAmount: bigint\n  ];\n  export interface OutputObject {\n    id: string;\n    buyer: string;\n    priceWei: bigint;\n    feeAmount: bigint;\n  }\n  export type Event = TypedContractEvent<InputTuple, OutputTuple, OutputObject>;\n  export type Filter = TypedDeferredTopicFilter<Event>;\n  export type Log = TypedEventLog<Event>;\n  export type LogDescription = TypedLogDescription<Event>;\n}\n\nexport interface Marketplace extends BaseContract {\n  connect(runner?: ContractRunner | null): Marketplace;\n  waitForDeployment(): Promise<this>;\n\n  interface: MarketplaceInterface;\n\n  queryFilter<TCEvent extends TypedContractEvent>(\n    event: TCEvent,\n    fromBlockOrBlockhash?: string | number | undefined,\n    toBlock?: string | number | undefined\n  ): Promise<Array<TypedEventLog<TCEvent>>>;\n  queryFilter<TCEvent extends TypedContractEvent>(\n    filter: TypedDeferredTopicFilter<TCEvent>,\n    fromBlockOrBlockhash?: string | number | undefined,\n    toBlock?: string | number | undefined\n  ): Promise<Array<TypedEventLog<TCEvent>>>;\n\n  on<TCEvent extends TypedContractEvent>(\n    event: TCEvent,\n    listener: TypedListener<TCEvent>\n  ): Promise<this>;\n  on<TCEvent extends TypedContractEvent>(\n    filter: TypedDeferredTopicFilter<TCEvent>,\n    listener: TypedListener<TCEvent>\n  ): Promise<this>;\n\n  once<TCEvent extends TypedContractEvent>(\n    event: TCEvent,\n    listener: TypedListener<TCEvent>\n  ): Promise<this>;\n  once<TCEvent extends TypedContractEvent>(\n    filter: TypedDeferredTopicFilter<TCEvent>,\n    listener: TypedListener<TCEvent>\n  ): Promise<this>;\n\n  listeners<TCEvent extends TypedContractEvent>(\n    event: TCEvent\n  ): Promise<Array<TypedListener<TCEvent>>>;\n  listeners(eventName?: string): Promise<Array<Listener>>;\n  removeAllListeners<TCEvent extends TypedContractEvent>(\n    event?: TCEvent\n  ): Promise<this>;\n\n  computeId: TypedContractMethod<[ipfsCid: string], [string], \"view\">;\n\n  feeRecipient: TypedContractMethod<[], [string], \"view\">;\n\n  getProduct: TypedContractMethod<\n    [ipfsCid: string],\n    [\n      [string, bigint, boolean] & {\n        seller: string;\n        priceWei: bigint;\n        exists: boolean;\n      }\n    ],\n    \"view\"\n  >;\n\n  hasBuyerAccess: TypedContractMethod<\n    [buyer: AddressLike, ipfsCid: string],\n    [boolean],\n    \"view\"\n  >;\n\n  listProduct: TypedContractMethod<\n    [ipfsCid: string, priceWei: BigNumberish],\n    [void],\n    \"nonpayable\"\n  >;\n\n  platformFeeBps: TypedContractMethod<[], [bigint], \"view\">;\n\n  purchase: TypedContractMethod<[ipfsCid: string], [void], \"payable\">;\n\n  setPlatformParams: TypedContractMethod<\n    [_platformFeeBps: BigNumberish, _feeRecipient: AddressLike],\n    [void],\n    \"nonpayable\"\n  >;\n\n  getFunction<T extends ContractMethod = ContractMethod>(\n    key: string | FunctionFragment\n  ): T;\n\n  getFunction(\n    nameOrSignature: \"computeId\"\n  ): TypedContractMethod<[ipfsCid: string], [string], \"view\">;\n  getFunction(\n    nameOrSignature: \"feeRecipient\"\n  ): TypedContractMethod<[], [string], \"view\">;\n  getFunction(\n    nameOrSignature: \"getProduct\"\n  ): TypedContractMethod<\n    [ipfsCid: string],\n    [\n      [string, bigint, boolean] & {\n        seller: string;\n        priceWei: bigint;\n        exists: boolean;\n      }\n    ],\n    \"view\"\n  >;\n  getFunction(\n    nameOrSignature: \"hasBuyerAccess\"\n  ): TypedContractMethod<\n    [buyer: AddressLike, ipfsCid: string],\n    [boolean],\n    \"view\"\n  >;\n  getFunction(\n    nameOrSignature: \"listProduct\"\n  ): TypedContractMethod<\n    [ipfsCid: string, priceWei: BigNumberish],\n    [void],\n    \"nonpayable\"\n  >;\n  getFunction(\n    nameOrSignature: \"platformFeeBps\"\n  ): TypedContractMethod<[], [bigint], \"view\">;\n  getFunction(\n    nameOrSignature: \"purchase\"\n  ): TypedContractMethod<[ipfsCid: string], [void], \"payable\">;\n  getFunction(\n    nameOrSignature: \"setPlatformParams\"\n  ): TypedContractMethod<\n    [_platformFeeBps: BigNumberish, _feeRecipient: AddressLike],\n    [void],\n    \"nonpayable\"\n  >;\n\n  getEvent(\n    key: \"ProductListed\"\n  ): TypedContractEvent<\n    ProductListedEvent.InputTuple,\n    ProductListedEvent.OutputTuple,\n    ProductListedEvent.OutputObject\n  >;\n  getEvent(\n    key: \"ProductPurchased\"\n  ): TypedContractEvent<\n    ProductPurchasedEvent.InputTuple,\n    ProductPurchasedEvent.OutputTuple,\n    ProductPurchasedEvent.OutputObject\n  >;\n\n  filters: {\n    \"ProductListed(bytes32,address,uint256,string)\": TypedContractEvent<\n      ProductListedEvent.InputTuple,\n      ProductListedEvent.OutputTuple,\n      ProductListedEvent.OutputObject\n    >;\n    ProductListed: TypedContractEvent<\n      ProductListedEvent.InputTuple,\n      ProductListedEvent.OutputTuple,\n      ProductListedEvent.OutputObject\n    >;\n\n    \"ProductPurchased(bytes32,address,uint256,uint256)\": TypedContractEvent<\n      ProductPurchasedEvent.InputTuple,\n      ProductPurchasedEvent.OutputTuple,\n      ProductPurchasedEvent.OutputObject\n    >;\n    ProductPurchased: TypedContractEvent<\n      ProductPurchasedEvent.InputTuple,\n      ProductPurchasedEvent.OutputTuple,\n      ProductPurchasedEvent.OutputObject\n    >;\n  };\n}\n","size_bytes":8292},"contracts/hardhat.config.ts":{"content":"import { HardhatUserConfig } from \"hardhat/config\";\nimport \"@nomicfoundation/hardhat-toolbox\";\nimport * as dotenv from \"dotenv\";\n\ndotenv.config();\n\nconst AMOY_RPC_URL = process.env.AMOY_RPC_URL || \"https://rpc-amoy.polygon.technology\";\nconst PRIVATE_KEY = process.env.PRIVATE_KEY || \"0x0000000000000000000000000000000000000000000000000000000000000001\";\n\nconst config: HardhatUserConfig = {\n\tsolidity: {\n\t\tversion: \"0.8.24\",\n\t\tsettings: {\n\t\t\toptimizer: { enabled: true, runs: 200 }\n\t\t}\n\t},\n\tnetworks: {\n\t\tamoy: {\n\t\t\turl: AMOY_RPC_URL,\n\t\t\taccounts: [PRIVATE_KEY]\n\t\t}\n\t},\n\tetherscan: {\n\t\tapiKey: {\n\t\t\tpolygonAmoy: process.env.POLYGONSCAN_API_KEY || \"\"\n\t\t}\n\t}\n};\n\nexport default config;\n\n\n","size_bytes":685},"contracts/test/Marketplace.test.ts":{"content":"import { expect } from \"chai\";\nimport { ethers } from \"hardhat\";\n\ndescribe(\"Marketplace\", function () {\n  it(\"should list a product and split payment with 20% fee\", async function () {\n    const [deployer, seller, buyer] = await ethers.getSigners();\n\n    const platformFeeBps = 2000; // 20%\n    const feeRecipient = deployer.address;\n\n    const Marketplace = await ethers.getContractFactory(\"Marketplace\");\n  const marketplace = await Marketplace.deploy(platformFeeBps, feeRecipient);\n  await marketplace.waitForDeployment();\n\n    const cid = \"QmTestCid123\";\n    const price = ethers.parseEther(\"1.0\");\n\n    // seller lists product\n    await marketplace.connect(seller).listProduct(cid, price);\n\n    // check product details\n    const product = await marketplace.getProduct(cid);\n    expect(product.seller).to.equal(seller.address);\n    expect(product.priceWei).to.equal(price);\n    expect(product.exists).to.equal(true);\n\n    // record balances before purchase\n    const sellerBefore = await ethers.provider.getBalance(seller.address);\n    const feeBefore = await ethers.provider.getBalance(feeRecipient);\n\n    // buyer purchases\n    const tx = await marketplace.connect(buyer).purchase(cid, { value: price });\n    await tx.wait();\n\n    // compute expected amounts\n    const feeAmount = price * BigInt(platformFeeBps) / BigInt(10000);\n    const sellerAmount = price - feeAmount;\n\n    // check balances after\n    const sellerAfter = await ethers.provider.getBalance(seller.address);\n    const feeAfter = await ethers.provider.getBalance(feeRecipient);\n\n    expect(sellerAfter - sellerBefore).to.equal(sellerAmount);\n    expect(feeAfter - feeBefore).to.equal(feeAmount);\n\n    // buyer should have access\n    const has = await marketplace.hasBuyerAccess(buyer.address, cid);\n    expect(has).to.equal(true);\n  });\n});\n","size_bytes":1815},"web/src/app/page.tsx":{"content":"\"use client\";\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\n\nexport default function Home() {\n  const [byCategory, setByCategory] = useState<Record<string, any[]>>({});\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(\"/api/products\");\n        const json = await res.json();\n        const grouped: Record<string, any[]> = {};\n        for (const p of json.items || []) {\n          const cat = p.category || \"other\";\n          grouped[cat] = grouped[cat] || [];\n          grouped[cat].push(p);\n        }\n        setByCategory(grouped);\n      } catch {}\n    })();\n  }, []);\n\n  return (\n    <section className=\"flex min-h-[50vh] flex-col items-center gap-8 w-full\">\n      <div className=\"w-full max-w-6xl flex items-center justify-between px-4\">\n        <h1 className=\"text-2xl font-semibold\">BlockShopy Marketplace</h1>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-6xl px-4\">\n        <Link href=\"/sell\" className=\"border rounded-xl p-6 hover:bg-gray-50 dark:hover:bg-zinc-900\">\n          <h3 className=\"text-lg font-medium\">Sell product →</h3>\n          <p className=\"text-sm text-muted-foreground\">Upload to IPFS and list for sale.</p>\n        </Link>\n        <Link href=\"/explore\" className=\"border rounded-xl p-6 hover:bg-gray-50 dark:hover:bg-zinc-900\">\n          <h3 className=\"text-lg font-medium\">Explore →</h3>\n          <p className=\"text-sm text-muted-foreground\">Browse and purchase digital goods.</p>\n        </Link>\n        <Link href=\"/dashboard\" className=\"border rounded-xl p-6 hover:bg-gray-50 dark:hover:bg-zinc-900\">\n          <h3 className=\"text-lg font-medium\">Seller dashboard →</h3>\n          <p className=\"text-sm text-muted-foreground\">Track listings and sales.</p>\n        </Link>\n      </div>\n\n      <div className=\"w-full max-w-6xl space-y-8 px-4\">\n        {Object.entries(byCategory).map(([cat, items]) => (\n          <div key={cat} className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold capitalize\">{cat}</h3>\n              <Link href={`/explore?category=${encodeURIComponent(cat)}`} className=\"text-sm text-muted-foreground hover:text-foreground\">View all</Link>\n            </div>\n            <div className=\"relative overflow-hidden\">\n              <div className=\"flex gap-4 animate-[marquee_30s_linear_infinite] will-change-transform\">\n                {items.map((p) => (\n                  <Link key={p._id || p.cid} href={`/explore?cid=${p.cid}`} className=\"min-w-[220px] border rounded-lg p-4\">\n                    <div className=\"text-sm font-medium truncate\">{p.name || p.cid}</div>\n                    <div className=\"text-xs text-muted-foreground\">{p.size ? Math.ceil(p.size/1024) + \" KB\" : \"\"}</div>\n                    <div className=\"text-xs text-muted-foreground\">CID: {String(p.cid).slice(0,10)}...</div>\n                  </Link>\n                ))}\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <style>{`@keyframes marquee {0%{transform:translateX(0)}100%{transform:translateX(-50%)}}`}</style>\n      <p className=\"text-center text-sm text-muted-foreground\">Network: Polygon Amoy testnet</p>\n    </section>\n  );\n}\n","size_bytes":3296},"web/src/app/about/page.tsx":{"content":"export default function AboutPage() {\n    return (\n        <div className=\"max-w-3xl mx-auto p-6 space-y-4\">\n            <h1 className=\"text-2xl font-semibold\">About BlockShopy</h1>\n            <p className=\"text-muted-foreground\">A decentralized marketplace for digital goods on Polygon Amoy. Sellers upload files to IPFS, list them on-chain, and buyers unlock downloads after purchase.</p>\n        </div>\n    );\n}\n\n\n\n\n","size_bytes":420},"web/src/app/sell/page.tsx":{"content":"\"use client\";\nimport { useState } from \"react\";\nimport { useAccount, useWriteContract, useWaitForTransactionReceipt } from \"wagmi\";\nimport { marketplaceAbi, MARKETPLACE_ADDRESS } from \"@/lib/contracts\";\nimport { Button, Input } from \"@/components/ui\";\nimport lighthouse from \"@lighthouse-web3/sdk\";\n\nexport default function SellPage() {\n\tconst { address } = useAccount();\n\tconst [file, setFile] = useState<File | null>(null);\n\tconst [priceEth, setPriceEth] = useState(\"0.01\");\n    const [name, setName] = useState(\"\");\n    const [description, setDescription] = useState(\"\");\n    const [category, setCategory] = useState(\"file\");\n\tconst [cid, setCid] = useState(\"\");\n\tconst [status, setStatus] = useState(\"\");\n\tconst { writeContract, data: txHash, isPending } = useWriteContract();\n\tconst { isSuccess } = useWaitForTransactionReceipt({ hash: txHash });\n\n\tasync function onUploadToIpfs() {\n\t\tif (!file) return;\n\t\tsetStatus(\"Uploading to Lighthouse...\");\n\t\tconst apiKey = process.env.NEXT_PUBLIC_LIGHTHOUSE_API_KEY || process.env.LIGHTHOUSE_API_KEY;\n\t\tif (!apiKey) { setStatus(\"Missing LIGHTHOUSE_API_KEY env\"); return; }\n\t\ttry {\n\t\t\tconst response = await lighthouse.uploadBuffer(file, apiKey);\n\t\t\t// response.data.Hash contains the CID\n\t\t\tconst theCid = (response as any)?.data?.Hash as string;\n\t\t\tif (!theCid) { setStatus(\"Upload failed: no CID\"); return; }\n            setCid(theCid);\n            setStatus(\"Uploaded. CID: \" + theCid);\n            // Save basic metadata (cid, owner, filename, size) to DB\n            try {\n                const metaRes = await fetch(\"/api/products\", {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify({\n                        cid: theCid,\n                        owner: address,\n                        name: name || file.name,\n                        description,\n                        size: file.size,\n                        category: category || file.type?.split(\"/\")?.[0] || \"file\",\n                        priceWei: String(Math.floor(parseFloat(priceEth || \"0\") * 1e18))\n                    })\n                });\n                if (!metaRes.ok) {\n                    console.warn(\"Failed saving metadata\");\n                }\n            } catch {}\n\t\t} catch (e: any) {\n\t\t\tsetStatus(\"Upload failed: \" + (e?.message || \"unknown error\"));\n\t\t}\n\t}\n\n\tasync function onList() {\n\t\tif (!cid) { setStatus(\"Upload first\"); return; }\n        const priceWei = BigInt(Math.floor(parseFloat(priceEth || \"0\") * 1e18));\n\t\twriteContract({\n\t\t\tabi: marketplaceAbi as any,\n\t\t\taddress: MARKETPLACE_ADDRESS as `0x${string}`,\n\t\t\tfunctionName: \"listProduct\",\n\t\t\targs: [cid, priceWei]\n\t\t});\n\t}\n\n    return (\n        <div className=\"max-w-xl mx-auto p-6 space-y-4\">\n            <h2 className=\"text-xl font-semibold\">Sell a product</h2>\n            <Input type=\"file\" onChange={(e) => setFile(e.target.files?.[0] || null)} />\n            <Input placeholder=\"Product name\" value={name} onChange={(e) => setName(e.target.value)} />\n            <Input placeholder=\"Description\" value={description} onChange={(e) => setDescription(e.target.value)} />\n            <Input placeholder=\"Category (e.g. book, image, code)\" value={category} onChange={(e) => setCategory(e.target.value)} />\n            <Input placeholder=\"Price in MATIC (e.g., 0.01)\" value={priceEth} onChange={(e) => setPriceEth(e.target.value)} />\n            <div className=\"flex gap-2\">\n                <Button variant=\"outline\" onClick={onUploadToIpfs}>Upload to IPFS</Button>\n                <Button onClick={onList} disabled={isPending}>List on-chain</Button>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">{status}</p>\n            {txHash && <p>Tx: {txHash}</p>}\n            {isSuccess && <p>Listed!</p>}\n        </div>\n    );\n}\n\n\n","size_bytes":3840},"web/src/components/HelperBanner.tsx":{"content":"\"use client\";\nimport { useEffect, useState } from \"react\";\n\nexport default function HelperBanner() {\n\tconst [show, setShow] = useState(true);\n\tconst needWalletConnect = !process.env.NEXT_PUBLIC_WALLETCONNECT_ID || process.env.NEXT_PUBLIC_WALLETCONNECT_ID === \"demo\";\n\tuseEffect(() => {\n\t\t// Only show if helpful\n\t\tif (!needWalletConnect) setShow(false);\n\t}, [needWalletConnect]);\n\tif (!show) return null;\n\treturn (\n\t\t<div className=\"w-full bg-yellow-100 text-yellow-900 text-sm px-4 py-2\">\n\t\t\t<b>Tip:</b> Use Polygon Amoy testnet and set a real WalletConnect Project ID in <code>web/.env</code> for best experience.\n\t\t</div>\n\t);\n}\n\n\n","size_bytes":633},"web/src/components/Nav.tsx":{"content":"\"use client\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\nimport { useAccount, useConnect, useDisconnect } from \"wagmi\";\nimport { injected } from \"@wagmi/connectors\";\n\nexport default function Nav() {\n    const router = useRouter();\n    const [query, setQuery] = useState(\"\");\n\tconst { address, isConnected } = useAccount();\n\tconst { connect } = useConnect();\n\tconst { disconnect } = useDisconnect();\n\treturn (\n\t\t<header className=\"w-full border-b bg-white/70 dark:bg-zinc-900/70 backdrop-blur sticky top-0 z-30\">\n\t\t\t<div className=\"mx-auto max-w-6xl px-4 h-14 flex items-center justify-between\">\n\t\t\t\t<nav className=\"flex items-center gap-5 text-sm\">\n\t\t\t\t\t<Link href=\"/\" className=\"flex items-center gap-3\">\n\t\t\t\t\t\t<img src=\"/logo.svg\" alt=\"BlockShopy\" className=\"h-8 w-auto\" />\n\t\t\t\t\t</Link>\n\t\t\t\t\t<Link href=\"/sell\" className=\"text-muted-foreground hover:text-foreground\">Sell</Link>\n\t\t\t\t\t<Link href=\"/explore\" className=\"text-muted-foreground hover:text-foreground\">Explore</Link>\n\t\t\t\t\t<Link href=\"/dashboard\" className=\"text-muted-foreground hover:text-foreground\">Dashboard</Link>\n                    <Link href=\"/about\" className=\"text-muted-foreground hover:text-foreground\">About</Link>\n                    <Link href=\"/how\" className=\"text-muted-foreground hover:text-foreground\">How it works</Link>\n\t\t\t\t</nav>\n                <div className=\"flex items-center gap-3 text-sm\">\n                    <input\n                        value={query}\n                        onChange={(e) => setQuery(e.target.value)}\n\t\t\t\t\t\tplaceholder=\"Search products by name\"\n\t\t\t\t\t\tclassName=\"h-8 w-56 rounded px-2 input-light text-sm\"\n                        onKeyDown={(e) => { if (e.key === \"Enter\") router.push(`/explore?q=${encodeURIComponent(query)}`); }}\n                    />\n\t\t\t\t\t{isConnected ? (\n\t\t\t\t\t\t<button className=\"rounded px-3 py-1 btn-accent\" onClick={() => disconnect()}>Disconnect {address?.slice(0,6)}...{address?.slice(-4)}</button>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<button className=\"rounded px-3 py-1 btn-accent\" onClick={() => connect({ connector: injected() })}>Connect Wallet</button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</header>\n\t);\n}\n\n\n","size_bytes":2193},"web/src/app/api/products/route.ts":{"content":"import { NextRequest } from \"next/server\";\nimport { getDb } from \"@/lib/db\";\n\nexport async function GET(req: NextRequest) {\n    try {\n        const url = new URL(req.url);\n        const q = url.searchParams.get(\"q\")?.toLowerCase()?.trim() || \"\";\n        const category = url.searchParams.get(\"category\")?.toLowerCase()?.trim();\n        const db = await getDb();\n        const filter: any = {};\n        if (q) filter[\"$or\"] = [\n            { name: { $regex: q, $options: \"i\" } },\n            { description: { $regex: q, $options: \"i\" } },\n            { cid: { $regex: q, $options: \"i\" } }\n        ];\n        if (category) filter.category = category;\n        const items = await db.collection(\"products\").find(filter, { projection: { _id: 1, cid: 1, name: 1, size: 1, category: 1, owner: 1, priceWei: 1, description: 1 } }).sort({ _id: -1 }).limit(200).toArray();\n        return new Response(JSON.stringify({ items }), { headers: { \"Content-Type\": \"application/json\" } });\n    } catch (e: any) {\n        return new Response(JSON.stringify({ error: e?.message || \"db error\" }), { status: 500 });\n    }\n}\n\nexport async function POST(req: NextRequest) {\n    try {\n        const body = await req.json();\n        const { cid, owner, name, size, category, description, priceWei } = body || {};\n        if (!cid) return new Response(\"cid required\", { status: 400 });\n        const db = await getDb();\n        const doc = {\n            cid,\n            owner: owner || null,\n            name: name || null,\n            size: Number(size) || null,\n            category: String(category || \"other\").toLowerCase(),\n            description: description || \"\",\n            priceWei: typeof priceWei === \"string\" || typeof priceWei === \"number\" ? String(priceWei) : null,\n            createdAt: new Date()\n        };\n        const result = await db.collection(\"products\").updateOne({ cid }, { $set: doc }, { upsert: true });\n        return new Response(JSON.stringify({ ok: true, upsertedId: result.upsertedId || null }), { headers: { \"Content-Type\": \"application/json\" } });\n    } catch (e: any) {\n        return new Response(JSON.stringify({ error: e?.message || \"db error\" }), { status: 500 });\n    }\n}\n\n\n","size_bytes":2192},"web/src/app/how/page.tsx":{"content":"export default function HowPage() {\n    return (\n        <div className=\"max-w-3xl mx-auto p-6 space-y-4\">\n            <h1 className=\"text-2xl font-semibold\">How it works</h1>\n            <ol className=\"list-decimal pl-6 space-y-2 text-muted-foreground\">\n                <li>Seller uploads a file to IPFS (Lighthouse) and sets a price.</li>\n                <li>Listing is created on the Polygon Amoy marketplace smart contract.</li>\n                <li>Buyer connects wallet and purchases; contract enforces platform fee.</li>\n                <li>After purchase, buyer signs a request and downloads via the site.</li>\n            </ol>\n        </div>\n    );\n}\n\n\n\n\n","size_bytes":664},"web/README.md":{"content":"This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).\n\n## Getting Started\n\nFirst, run the development server:\n\n```bash\nnpm run dev\n# or\nyarn dev\n# or\npnpm dev\n# or\nbun dev\n```\n\nOpen [http://localhost:3000](http://localhost:3000) with your browser to see the result.\n\nYou can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.\n\nThis project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.\n\n## Learn More\n\nTo learn more about Next.js, take a look at the following resources:\n\n- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.\n- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.\n\nYou can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!\n\n## Deploy on Vercel\n\nThe easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.\n\nCheck out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.\n","size_bytes":1450},"web/src/components/Chatbot.tsx":{"content":"\"use client\";\nimport { useState } from \"react\";\n\nexport default function Chatbot() {\n\tconst [input, setInput] = useState(\"\");\n\tconst [answer, setAnswer] = useState(\"\");\n\tasync function ask() {\n\t\tconst res = await fetch(\"/api/chat\", { method: \"POST\", body: JSON.stringify({ messages: [input] }) });\n\t\tconst json = await res.json();\n\t\tsetAnswer(json.text || \"\");\n\t}\n\treturn (\n\t\t<div className=\"fixed bottom-4 right-4 w-80 border rounded-xl bg-white dark:bg-zinc-900 p-4 space-y-2 shadow-lg\">\n\t\t\t<h4 className=\"font-medium\">Assistant</h4>\n\t\t\t<textarea className=\"w-full border rounded p-2\" rows={3} value={input} onChange={(e) => setInput(e.target.value)} placeholder=\"Ask how to sell or buy...\" />\n\t\t\t<button className=\"border rounded px-3 py-1\" onClick={ask}>Ask</button>\n\t\t\t{answer && <div className=\"text-sm whitespace-pre-wrap border-t pt-2\">{answer}</div>}\n\t\t</div>\n\t);\n}\n\n\n","size_bytes":877},"web/src/app/layout.tsx":{"content":"import type { Metadata } from \"next\";\nimport { Geist, Geist_Mono } from \"next/font/google\";\nimport \"./globals.css\";\nimport Providers from \"./providers\";\nimport Chatbot from \"../components/Chatbot\";\nimport Nav from \"../components/Nav\";\nimport HelperBanner from \"../components/HelperBanner\";\n\nconst geistSans = Geist({\n  variable: \"--font-geist-sans\",\n  subsets: [\"latin\"],\n});\n\nconst geistMono = Geist_Mono({\n  variable: \"--font-geist-mono\",\n  subsets: [\"latin\"],\n});\n\nexport const metadata: Metadata = {\n  title: \"Create Next App\",\n  description: \"Generated by create next app\",\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"en\">\n      <body\n        className={`${geistSans.variable} ${geistMono.variable} antialiased`}\n      >\n        <Providers>\n          <HelperBanner />\n          <Nav />\n          <main className=\"mx-auto max-w-6xl px-4 py-8\">\n            {children}\n          </main>\n        </Providers>\n        <Chatbot />\n      </body>\n    </html>\n  );\n}\n","size_bytes":1048},"web/src/components/ui.tsx":{"content":"import { cva } from \"class-variance-authority\";\nimport { twMerge } from \"tailwind-merge\";\nimport { InputHTMLAttributes, ButtonHTMLAttributes } from \"react\";\n\nexport function cn(...classes: (string | undefined | null | false)[]) {\n\treturn twMerge(classes.filter(Boolean).join(\" \"));\n}\n\nconst buttonStyles = cva(\n\t\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus:outline-none disabled:opacity-50 disabled:pointer-events-none\",\n\t{ variants: { variant: { default: \"btn-accent\", outline: \"border-gray-300 hover:bg-gray-50 dark:border-zinc-700 dark:hover:bg-zinc-800\" }, size: { default: \"h-10 px-4\", sm: \"h-9 px-3\", lg: \"h-11 px-6\" } }, defaultVariants: { variant: \"default\", size: \"default\" } }\n);\n\nexport function Button(props: ButtonHTMLAttributes<HTMLButtonElement> & { variant?: \"default\" | \"outline\"; size?: \"default\" | \"sm\" | \"lg\" }) {\n\tconst { className, variant = \"default\", size = \"default\", ...rest } = props;\n\treturn <button className={cn(buttonStyles({ variant, size }), className)} {...rest} />;\n}\n\nexport function Input(props: InputHTMLAttributes<HTMLInputElement>) {\n\tconst { className, ...rest } = props;\n\treturn <input className={cn(\"rounded-md px-3 h-10 text-sm w-full input-light border-none\", className)} {...rest} />;\n}\n\n\n","size_bytes":1286},"web/src/app/api/download/[cid]/route.ts":{"content":"import { createPublicClient, http, verifyMessage } from \"viem\";\nimport { polygonAmoy } from \"viem/chains\";\nimport { marketplaceAbi, MARKETPLACE_ADDRESS } from \"@/lib/contracts\";\n\nexport async function POST(req: Request, { params }: any): Promise<Response> {\n\tconst { cid } = params as { cid?: string } || {};\n\tif (!cid) return new Response(\"Missing cid\", { status: 400 });\n\tconst { address, signature } = await req.json().catch(() => ({}));\n\tif (!address || !signature) return new Response(\"Missing address/signature\", { status: 400 });\n\n\tconst message = `download:${cid}`;\n\tconst okSig = await verifyMessage({ address, message, signature }).catch(() => false);\n\tif (!okSig) return new Response(\"Bad signature\", { status: 401 });\n\n    const client = createPublicClient({ chain: polygonAmoy, transport: http() });\n    const hasAccess = await client.readContract({\n        abi: marketplaceAbi as any,\n        address: MARKETPLACE_ADDRESS as `0x${string}`,\n        functionName: \"hasBuyerAccess\",\n        account: address as `0x${string}`,\n        args: [cid]\n    }).catch(() => false) as boolean;\n\n\tif (!hasAccess) return new Response(\"No access\", { status: 403 });\n\n\tconst gatewayUrl = `https://gateway.lighthouse.storage/ipfs/${cid}`;\n\tconst resp = await fetch(gatewayUrl);\n\tif (!resp.ok || !resp.body) return new Response(\"Fetch failed\", { status: 502 });\n\n\tconst fileName = resp.headers.get(\"content-disposition\")?.match(/filename=\"([^\"]+)\"/)?.[1] || `${cid}`;\n\tconst contentType = resp.headers.get(\"content-type\") || \"application/octet-stream\";\n\treturn new Response(resp.body, {\n\t\theaders: {\n\t\t\t\"Content-Type\": contentType,\n\t\t\t\"Content-Disposition\": `attachment; filename=\"${fileName}\"`\n\t\t}\n\t});\n}\n\n\n","size_bytes":1703},"web/src/app/dashboard/seller/page.tsx":{"content":"\"use client\";\n\nimport { useState } from \"react\";\nimport { Button, Input } from \"@/components/ui\";\n\ntype Product = {\n  cid: string;\n  name: string;\n  category: string;\n  price: string;\n};\n\nconst dummyProducts: Product[] = [\n  { cid: \"QmDemoCID1\", name: \"Demo Book PDF\", category: \"Books\", price: \"0.05\" },\n  { cid: \"QmDemoCID2\", name: \"Website Clone Code\", category: \"Code\", price: \"0.10\" },\n  { cid: \"QmDemoCID3\", name: \"App Template\", category: \"Apps\", price: \"0.08\" }\n];\n\nexport default function SellerDashboard() {\n  const [products, setProducts] = useState<Product[]>(dummyProducts);\n  const [showUpload, setShowUpload] = useState(false);\n  return (\n    <section className=\"max-w-3xl mx-auto p-8\">\n      <h1 className=\"text-2xl font-bold text-pink-600 mb-6\">Seller Dashboard</h1>\n      <Button onClick={() => setShowUpload(true)} className=\"bg-pink-600 text-white mb-4\">Upload New Product</Button>\n      {/* Product list */}\n      <div className=\"space-y-4\">\n        {products.length === 0 ? (\n          <div className=\"text-muted-foreground\">No products uploaded yet.</div>\n        ) : (\n          products.map((p) => (\n            <div key={p.cid} className=\"border rounded-lg p-4 flex justify-between items-center\">\n              <div>\n                <div className=\"font-semibold\">{p.name}</div>\n                <div className=\"text-xs text-muted-foreground\">{p.category} · {p.price} MATIC</div>\n              </div>\n              <Button className=\"bg-black text-pink-400\">Edit</Button>\n            </div>\n          ))\n        )}\n      </div>\n      {/* Upload modal */}\n      {showUpload && (\n        <div className=\"fixed inset-0 bg-black/40 flex items-center justify-center z-50\">\n          <div className=\"bg-white dark:bg-zinc-900 rounded-xl p-8 w-full max-w-md shadow-xl\">\n            <h2 className=\"text-xl font-bold mb-4 text-pink-600\">Upload Product</h2>\n            <form className=\"space-y-4\">\n              <Input type=\"text\" placeholder=\"Product Name\" required />\n              <Input type=\"text\" placeholder=\"Category\" required />\n              <Input type=\"number\" placeholder=\"Price (MATIC)\" required />\n              <Input type=\"text\" placeholder=\"Wallet Address (for payment)\" required />\n              <Input type=\"file\" required />\n              <Button type=\"submit\" className=\"bg-pink-600 text-white\">Upload</Button>\n              <Button type=\"button\" className=\"bg-black text-pink-400\" onClick={() => setShowUpload(false)}>Cancel</Button>\n            </form>\n          </div>\n        </div>\n      )}\n    </section>\n  );\n}\n","size_bytes":2557},"web/src/app/globals.css":{"content":"@import \"tailwindcss\";\n\n:root {\n  --bg: #0b0b0b; /* black base */\n  --card: #0f0f0f;\n  --accent: #ff4da6; /* bright pink */\n  --muted: #bdb6bd;\n  --text: #ffffff;\n}\n\n@media (prefers-color-scheme: light) {\n  :root {\n    --bg: #fff7fb; /* very light pink */\n    --card: #ffffff;\n    --accent: #ff4da6;\n    --muted: #6b6b6b;\n    --text: #111111;\n  }\n}\n\nbody {\n  background: var(--bg);\n  color: var(--text);\n  font-family: Arial, Helvetica, sans-serif;\n}\n\n.accent {\n  color: var(--accent);\n}\n\n.btn-accent {\n  background: linear-gradient(90deg,var(--accent),#ff2d8f);\n  color: white;\n}\n\n.input-light {\n  background: rgba(255,255,255,0.06);\n  border: 1px solid rgba(255,255,255,0.08);\n}\n","size_bytes":681},"web/src/shims/empty.js":{"content":"module.exports = {};\n","size_bytes":21}},"version":2}